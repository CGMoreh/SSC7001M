---
title: "Advanced Research Methods 1"
subtitle: "SSC7001M"
author: "Dr. Chris Moreh<br> York St. John University"
#institute: "York St. John University"
date: "2022"
output:
  xaringan::moon_reader:
    # self_contained: true ## create self-contained slides (https://yihui.org/en/2021/06/self-contained-xaringan/)
    # seal: false ## hide the deck-title slide
    css: ["css/rutgers-rmarkdown.css", "css/rutgers-fonts_og.css"]
     # - assets/css/tachyons.min.css
     # - assets/css/animate.css
     # - assets/css/moffitt-xaringan.css
     #  - assets/css/moffitt-colors.css
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      # titleSlideClass: ["middle", "right"]
      # ratio: "16:9"
classoption: xcolor=table
header-includes:
      - \usepackage{booktabs}
      - \usepackage{tabu}
      - \usepackage{threeparttable}
      - \usepackage{threeparttablex}
      - \usepackage[normalem]{ulem}
---
class: inverse, center, middle

```{r setup, include=FALSE} 
knitr::opts_chunk$set(
  fig.width = 10, fig.height = 6, fig.retina = 2,
  warning = FALSE, message = FALSE, options(digits = 5)
)
```  

```{r required-packages, eval=FALSE, include=FALSE}
devtools::install_github("gadenbuie/metathis@05f8ba1f")
devtools::install_github("gadenbuie/countdown@5c895d980")
devtools::install_github("gadenbuie/xaringanExtra")
install.packages("xaringanthemer")  
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_light(
  base_color = "#293352",
#  header_font_google = google_font("Josefin Sans"),
#  text_font_google   = google_font("Montserrat", "300", "300i"),
#  code_font_google   = google_font("Fira Mono")
)
# Course logo colour match
# "#C4961A", "#FC4E07", "#D16103", "#52854C", "#293352"
```

```{r xaringanExtra, echo = FALSE}
# devtools::install_github("gadenbuie/xaringanExtra")
xaringanExtra::use_progress_bar(color = "#0051BA", location = "bottom")
```

```{r eval=FALSE, include=FALSE}
## Run all code to live preview the slides
xaringan:::inf_mr()
```


# .blue[Week 12]

--

## Multilevel/longitudinal models

---

# A brief review of single-level regression

- A dependent variable: $y_i$ 
 - e.g. $y_{\mathrm{survey respondent}}$

- The multiple regression model for $p$ number of predictors:
#### $$  Y = \beta_0 + \beta_1 \ X_1 + \beta_2 \ X_2 + \beta_3 \ X_3 + \dots + \beta_p \ X_p + e $$

$$\mathscr{gpa} = b_{\mathrm{intercept}} + b_{\mathrm{occ}}\cdot \mathscr{occasion} + \epsilon$$

---

# Applied example from Weeks 4 and 6 

```{r, include=FALSE}
library(tidyverse)
library(mosaic)
library(ggformula)
library(kableExtra)
```

--
Data from Österman (2021) "Can We Trust Education for Fostering Trust? Quasi-experimental Evidence on the Effect of Education and Tracking on Social Trust"

```{r import data, include=TRUE}
## Load the Osterman data:
osterman <- haven::read_dta("https://cgmoreh.github.io/SSC7001M/data/osterman.dta")
```

- cumulative European Social Survey (ESS) data, consisting
of the nine rounds from 2002 to 2018

- data are weighted using ESS design weights (we will disregard this, sowe can expect our results to always differ somewhat!)

- follows 'the established approach of using a validated three-item scale' to study generalised social trust

- data also includes twenty-seven educational reforms implemented in sixteen European countries over six decades, where for each reform we can compare earlier reform-unaffected cohorts with later reform-affected cohorts

---
# Applied regression

Data from Österman (2021) "Can We Trust Education for Fostering Trust? Quasi-experimental Evidence on the Effect of Education and Tracking on Social Trust"

- The scale consists of the classic trust question, an item on whether people try to be fair, and an
item on whether people are helpful:
  - ‘Generally speaking, would you say that most people can be trusted, or that you can’t be too careful in dealing with people?’
  - ‘Do you think that most people would try to take advantage of you if they got the chance, or would they try to be fair?’
    - ‘Would you say that most of the time people try to be helpful or that they are mostly looking out for themselves?’
    
- All of the items may be answered on a scale from 0 to 10 (where 10 represents the highest level of trust) and the scale is calculated as the mean of the three items

- The three-item scale improves measurement reliability and cross-country validity compared to using a single item, such as the classic trust question.

---

```{css, echo = F}
table {
  font-size: 13px;     
}
```
## Descriptive statistics


```{r echo=FALSE}
my.summary <- function(x, na.rm=TRUE){
  result <- c(N=length(x[!is.na(x)]),
              Mean=round(mean(x, na.rm=na.rm), 3),
              SD=round(sd(x, na.rm=na.rm), 3),
              Min=min(x, na.rm=na.rm),
              Max=max(x, na.rm=na.rm))
}


sumtab <- data.frame(sapply(osterman, my.summary)) %>% select(-(cntry:dweight))

knitr::kable(data.frame(t(sumtab)), caption = "Table 2 in Österman (2021)")
```

---
# Multiple linear regression

- it allows us to test the joint effects of more than one predictor

- usually, we are interested in one primary predictor, but *while taking into account*, or *holding constant* the values of other predictors
- it allows us to account for the possible effect of other factors (variables) that may influence our regression results

- the multiple regression model for $p$ number of predictors can be written as:
#### $$  Y = \beta_0 + \beta_1 \ X_1 + \beta_2 \ X_2 + \beta_3 \ X_3 + \dots + \beta_p \ X_p + e $$

- but visualising it is a bit more difficult...

---
# Multiple linear regression

.center[
<img src="../pics/03_reg3.png" width="85%" align="center">
]

---
# Applied multiple regression

## Does education predict trust, while accounting for age and gender?

```{r, eval=FALSE, include=TRUE}
## Load the Osterman data:
osterman <- haven::read_dta("https://cgmoreh.github.io/SSC7001M/data/osterman.dta")
```

```{r, eval=FALSE, include=TRUE}
m_multiple <- lm(trustindex3 ~ eduyrs25 + agea + female, data = osterman)
summary(m_multiple)
```

---
# Applied multiple regression

### Does education predict trust, while accounting for age and gender?

```{r}
m_multiple <- lm(trustindex3 ~ eduyrs25 + agea + female, data = osterman)
summary(m_multiple)
```

---
class: inverse, center, middle

<br><br>
# Coffee break!
.center[
<img src="figures/coffee.gif" width="50%" align="center">
]

---
# Exercises

## 1. In a new Rmd file, reproduce the multiple regression of trust on education, age and gender

## 2. Build a new regression which **also** includes 'paternal education' and 'belonging to an ethnic minority group'

## 3. Using the Osterman data, does 'institutional trust' predict generalised social trust if we account for age, gender and whether parents were born outside Europe?

## 4. Free exercise using **your own** data!